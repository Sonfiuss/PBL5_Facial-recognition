    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Web quản lý sinh viên</title>
        <link rel="stylesheet"  href="../../css/style.css">
        <link rel="stylesheet" href="../../css/fontawesome/css/all.css">
        <style>
        
        </style>
    </head>
    <body>
        <div class="header">
            
        </div>
        <div class="menu"> 
            <ul class="list_menu">
                <li><a href="../manage.html">Trang chủ</a></li>
            <li><a href="../lop.html"><i class="fas fa-users"></i>&ensp;LỚP</a></li>
            <li><a href="../sinhvien.html"><i class="fas fa-graduation-cap"></i>&ensp;SINH VIÊN</a></li>
            <li><a href="../diemdanh.html"><i class="fas fa-check"></i>&ensp;ĐIỂM DANH</a></li>
            <li><a href="../contact.html"><i class="fas fa-address-book"></i>&ensp;CONTACT</a></li>                   
            </ul>
        </div>
        <div class="main">
            <div class="main-contain">
                <h2>Sửa thông tin sinh viên</h2>
                <div class="form">
                    <span style="font-size: 20px; color: red; font-style: italic"><b>Mời nhập lại thông tin sinh viên: </b> </span> 
                        <br>
                        (Chú ý điền đủ thông tin)
                        <br><br>
                        <form metdod="post">
                            <table>
                                <tr> 
                                    <td>Mã số sinh viên </td>
                                    <td> <input type="text" id="idsv" value="" readonly></td>
                                </tr>
                                <tr> 
                                    <td>Họ tên </td>
                                    <td> <input type="text" id="ten" value=""></td>
                                </tr>
                                <tr>
                                    <td>Ngày sinh </td>
                                    <td> <input type="date" id="ngaysinh" value= ""></td>
                                </tr>
                                <tr>
                                    <td>Mail </td>
                                    <td> <input type="text" id="mail" value=""></td>
                                </tr>
                                <tr>
                                    <td>Số điện thoại </td>
                                    <td> <input type="text" id="sdt" value=""></td>
                                </tr>
                                <tr>
                                    <td>Chọn Lớp  </td>
                                    <td> <select id="lop" widtd="80">
                                         
                                        </select>
                                    </td>	
                                </tr>
                                <tr>
                                    <td colspan=2>
                                    <input id="btnChapNhan" type="submit" value="Cập nhật" name="sua">
                                    <input id="btnXoa" type="submit" value="Xóa" name="xoa">
                                    </td>
                                </tr>
                            </table>
                        </form>
                        <br>Chọn menu bên trên hoặc click <a href="../sinhvien.html" style="color: blue; text-decoration:underline">vào đây</a> để quay lại danh sách sinh viên.
                </div>        
            </div>
        </div>
        <div class="clear"></div>
        <div class="footer">
            <p ><h4>Email: diemdanhkhuonmat@gmail.com &emsp; &emsp; &emsp; Sđt: 0384444284</h4></p>
        </div>
        <script type="module">
            // Import tde functions you need from tde SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";
            // TODO: Add SDKs for Firebase products tdat you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
    
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyD5JNwgNouvihlohxiGa8Bpg67pkmvkFK8",
                autdDomain: "mydbpbl5.firebaseapp.com",
                databaseURL: "https://mydbpbl5-default-rtdb.firebaseio.com",
                projectId: "mydbpbl5",
                storageBucket: "mydbpbl5.appspot.com",
                messagingSenderId: "779874823764",
                appId: "1:779874823764:web:73a3033d24ed17902ac7c1",
                measurementId: "G-E7XC29K07T"
            };
        
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
    
            import {getDatabase, ref, get, set, child, update, remove, onValue} 
            from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
    
            const db = getDatabase();
            
            //--------references--------
            var idsv = document.getElementById("idsv"); 
            var ten = document.getElementById("ten"); 
            var ngaysinh = document.getElementById("ngaysinh");
            var sdt = document.getElementById("sdt");
            var mail = document.getElementById("mail");
            var idlop = document.getElementById("lop");

            //--------function--------
            function Updatedata() {
                update(ref(db,"Student/"+idsvload.value),{
                    id_student: idsv.value,
                    name: ten.value,
                    birthday: ngaysinh.value,
                    mail: mail.value,
                    phone: sdt.value,
                    image: idsv.value+".jpg",
                    id_class: idlop.value,
                })
                .then(()=>{
                    alert("data stored Successfully!!!!")
                })
                .catch((error)=>{
                    alert("Error: "+error)
                });
            }
            function Deletedata() {

                remove(ref(db,"Student/"+idsv.value))
                .then(()=>{
                    alert("data removed Successfully!!!!")
                })
                .catch((error)=>{
                    alert("Error: "+error)
                });
            }
            function Selectdata() {
                const dbref1 = ref(db,'ActivityClass');

                onValue(dbref1,(snapshot) =>{

                snapshot.forEach(childSnapshot =>{
                        AddItemsToSelect(childSnapshot.key,childSnapshot.val().nameclass);
                });
                
                })
                const dbref = ref(db);
                get(child(dbref,"Student/"+idsvload)).then((snapshot)=>{
                    if(snapshot.exists()){
                        idsv.value = snapshot.key;
                        ten.value = snapshot.val().name;
                        ngaysinh.value = snapshot.val().birthday;
                        mail.value = snapshot.val().mail;
                        sdt.value = snapshot.val().phone;
                        idlop.value = snapshot.val().idclass;
                    }
                    else{
                        alert("No data found");
                    }
                })
                .catch((error)=>{
                    alert("Unsuccessful: "+error);
                });
            }

            window.onload = Selectdata;

            var select = document.getElementById("lop");

            function AddItemsToSelect(id, name) {

                var option = document.createElement("option");

                option.value = id;
                option.text = name;

                select.appendChild(option);
            
            }

            function checkdelete(){
                var rs = confirm("Bạn có muốn xóa sinh viên có số báo danh: "+idsv.value);
                if(rs ==true){
                    Deletedata();
                }
            }
            //--------events--------
            var btnCapnhat = document.getElementById("btnChapNhan");
            btnCapnhat.addEventListener('click',Updatedata);

            var btnXoa = document.getElementById("btnXoa");
            btnXoa.addEventListener('click',checkdelete);

            const queryString = window.location.search;
            console.log(queryString);

            const urlParams = new URLSearchParams(queryString);

            const idsvload = urlParams.get('idsv')
            console.log(idsvload);
        </script>  
    </body>
    </html>