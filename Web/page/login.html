<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web quản lý sinh viên</title>
    <link rel="stylesheet"  href="../css/style.css">
    <style>
       
    </style>
</head>
<body>
    <div class="header1">
          <a href="../index.html" class = "home">Trang chủ</a>
      <div class="content1">
        <b>Đăng nhập</b>
      </div>      
    </div>        
    <div class="mainlogin">
        <!-- <div class="maincontent"> -->
          <div class="content2">
            <div class="content21">
              <br><br><br>
              <input type="text" name="mail" id="mail"  class="form-control" value="" placeholder="Tên tài khoản mail" autocomplete="username">
              <br><br><br><br>  
              <input type="password" name="password" id="password" class="form-control" value="" placeholder="Mật khẩu" autocomplete="current-password">
              <br>
              <input type="checkbox" name="rememberusername" id="rememberusername" value="1">
              <label for="rememberusername">Nhớ tên tài khoản</label>
              <br><br>
              <button type="submit" class="btn btn-primary btn-block mt-3" id="loginbtn">Đăng nhập</button>
            </div>
            <div class="content21">
              <br><br><br>
              <div><b><h2>Bạn quên kí danh hoặc mật khẩu?</h2></b></div>
              <br><br>
              <div>Trình duyệt của bạn cần phải mở chức năng quản lí cookie</div>
            </div>
          </div>
        <!-- </div> -->
    </div>
    <div class="clear"></div>
    <div class="footer">
      <div class="info" float="right">
        <p ><h4>Email: diemdanhkhuonmat@gmail.com &emsp; &emsp; &emsp; Call us: 0384444284</h4></p>
      </div>
    </div>
    <script type="module">
      // Import tde functions you need from tde SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products tdat you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
          apiKey: "AIzaSyD5JNwgNouvihlohxiGa8Bpg67pkmvkFK8",
          autdDomain: "mydbpbl5.firebaseapp.com",
          databaseURL: "https://mydbpbl5-default-rtdb.firebaseio.com",
          projectId: "mydbpbl5",
          storageBucket: "mydbpbl5.appspot.com",
          messagingSenderId: "779874823764",
          appId: "1:779874823764:web:73a3033d24ed17902ac7c1",
          measurementId: "G-E7XC29K07T"
      };
  
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      import {getDatabase, ref, get, set, child, update, remove, onValue} 
      from "https://www.gstatic.com/firebasejs/9.8.4/firebase-database.js";

      const db = getDatabase();

      window.onload = checklogin;

      const loginbtn = document.querySelector('#loginbtn');
      const mail = document.querySelector('#mail');
      const password = document.querySelector('#password');
      
      //--------function--------
      mail.addEventListener('keyup', (e) =>{
          if(e.keyCode === 13){
              if(checklogin()) {
                window.location.href = "manage.html";
              }
              else{
                  alert("Email hoặc password sai thông tin!!!");
              }
            }
      })
      password.addEventListener('keyup', (e) =>{
        if(e.keyCode === 13){
            if(checklogin()) {
              window.location.href = "manage.html";
            }
            else{
                alert("Email hoặc password sai thông tin!!!");
            }
          }
      })
      function checklogin() {
        var check  = false;
        const dbref = ref(db,'Account');
        onValue(dbref,(snapshot) =>{
            snapshot.forEach(ChildSnapshot =>{
                if(mail.value == ChildSnapshot.val().Mail && password.value == ChildSnapshot.val().PassWord){
                    check = true;
                }
            });
        })
        return check;
      }

      loginbtn.addEventListener('click',function(){
        if(checklogin()) {
            window.location.href = "manage.html";
        }
        else{
            alert("Email hoặc password sai thông tin!!!");
        }
      })
      
  </script>
</body>
</html>