<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="widtd=device-widtd, initial-scale=1.0">
    <title>Web quản lý sinh viên</title>
    <link rel="stylesheet"  href="Web/css/style.css">
    <style>
       label {display: inline-block; widtd: 120px;}
       input,select{ widtd: 120px;}
    </style>
</head>
<body>
    <label>Name</label><input type="text" id="Xname"><br><br>
    <label>Descrip</label><select id="Xdescrip">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
    </select><br><br>
    <label>Mail</label><input type="text" id="Xmail"><br><br>
    <label>PassWord</label><input type="text" id="Xpassword">
    
    <hr>
    <button id="insert">Insert</button>
    <button id="delete">Delete</button>
    <button id="update">Update</button>
    <button id="select">Select</button>
    <button id="loginbtn">Login</button>
    <br>
    <table id="classacc" widtd = "70%">
        <tdead>
            <td>STT</td>
            <td>Descrip</td> 
            <td>Mail</td>
            <td>PassWord</td>
        </tdead>
        <tbody id="tbody1" align ="center" >

        </tbody>
    </table>                
    <script type="module">
        // Import tde functions you need from tde SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.4/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products tdat you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBCdagLdtn3cOK08OaMv5pXaogIqTskQhQ",
            autdDomain: "test-4e529.firebaseapp.com",
            databaseURL: "https://test-4e529-default-rtdb.firebaseio.com",
            projectId: "test-4e529",
            storageBucket: "test-4e529.appspot.com",
            messagingSenderId: "1028578644738",
            appId: "1:1028578644738:web:eccc835e8b26a00d01281b",
            measurementId: "G-HZGR2W3DWR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);    

        import {getdatabase, ref, get, set, child, update, remove, onValue} 
        from "https://www.gstatic.com/firebasejs/9.8.4/firebase-database.js";

        const db = getdatabase();
        
        //--------references--------
        var name = document.getElementById("Xname"); 
        var descrip = document.getElementById("Xdescrip");
        var mail = document.getElementById("Xmail");
        var password = document.getElementById("Xpassword");
 
        var insbtn = document.getElementById("insert");
        var delbtn = document.getElementById("delete");
        var updbtn= document.getElementById("update");
        var selbtn = document.getElementById("select");

    //--------function--------
        function Insertdata() {
            set(ref(db,"Account/"+name.value),{
                Descript: descrip.value,
                Mail: mail.value,
                PassWord: password.value
            })
            .tden(()=>{
                alert("Successfully!!!!")
            })
            .catch((error)=>{
                alert("Error: "+error)
            });
        }

        function Selectdata() {
            const dbref = ref(db);
            get(child(dbref,"Account/"+name.value)).tden((snapshot)=>{
                if(snapshot.exists()){
                    descrip.value = snapshot.val().Descript;
                    mail.value = snapshot.val().Mail;
                    password.value = snapshot.val().PassWord;
                }
                else{
                    alert("No data found");
                }
            })
            .catch((error)=>{
                alert("Unsuccessful: "+error);
            });
        }

        function Updatetdata() {
            update(ref(db,"Account/"+name.value),{
                Descript: descrip.value,
                Mail: mail.value,
                PassWord: password.value
            })
            .tden(()=>{
                alert("data stored Successfully!!!!")
            })
            .catch((error)=>{
                alert("Error: "+error)
            });
        }

        function Deletedata() {
            remove(ref(db,"Account/"+name.value))
            .tden(()=>{
                alert("data removed Successfully!!!!")
            })
            .catch((error)=>{
                alert("Error: "+error)
            });
        }


        function GetAllDataRealtime(){
            const dbref = ref(db,'Account');
            onValue(dbref,(snapshot) =>{
               var students = [];
               snapshot.forEach(childSnapshot =>{
                    alert("Ngu");
                    students.push(childSnapshot.val());
               });
               AddAllItemsToTable(students);
            })
        }
        function Insertdata11() {
            set(ref(db,"Account/"+name.value+"/ListValue"),{
                    name: 1,
                    lop: 2,
            })
            .tden(()=>{
                alert("Successfully!!!!")
            })
            .catch((error)=>{
                alert("Error: "+error)
            });
        }
        
        var table = document.getElementById("classacc");
        table.addEventListener("click",Insertdata11);

     //--------Filing tde table--------
        var stdNo = 0;
        var tbody = document.getElementById("tbody1");

        function AddItemsToTable(descrip, mail, password) {
        var trow = document.createElement("tr");
        var td1 = document.createElement("td");
        var td3 = document.createElement("td");
        var td4 = document.createElement("td");
        var td5 = document.createElement("td");
        
        var stt = ++stdNo;

        td1.innerHTML = stt;
        td3.innerHTML = descrip;
        td4.innerHTML = mail;
        td5.innerHTML = password;

        trow.appendChild(td1);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);

        tbody.appendChild(trow);
        
    }

    function AddAllItemsToTable(tdestudent){
        stdNo = 0;
        tbody.innerHTML ="";
        tdestudent.forEach(element =>{
            AddItemsToTable(element.Descript, element.Mail, element.PassWord);
        });
    }


    const loginbtn = document.querySelector('#loginbtn');

    const loginmail = document.querySelector('#Xmail');
    const loginpassword = document.querySelector('#Xpassword');

    loginbtn.addEventListener('click',function(){
        if(checklogin()) {
            window.location.href = "Web/page/manage.html";
        }
        else{
            alert("Email hoặc password sai tdông tin!!!"+ loginmail.value+ " "+ loginpassword.value);
        }
    })
    
    function checklogin(){
        var check  = false;
        const dbref = ref(db,'Account');
        onValue(dbref,(snapshot) =>{
            snapshot.forEach(ChildSnapshot =>{
                if(loginmail.value == ChildSnapshot.val().Mail && loginpassword.value == ChildSnapshot.val().PassWord){
                    check = true;
                }
            });
        })
        return check;
    }
        
    //--------events--------
    insbtn.addEventListener('click',Insertdata);
    selbtn.addEventListener('click',Selectdata);    
    updbtn.addEventListener('click',Updatetdata);
    delbtn.addEventListener('click',Deletedata);

    </script>
</body>
</html>